{
  "hash": "1c631246aefc0dd2b17202207f8ec3af",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Take Home Exercise 1\"\nsubtitle: \"Exploring Data Visualizations\"\nformat: html\ndate: 05/01/2025\ndate-format: long\ndate-modified: last-modified\neditor: visual\nexecute:\n  eval: true\n  echo: true\n  warning: false\n  freeze: true\n---\n\n\n\n# 1.1 Setting the Scene\n\nIntroduction & description of the dataset.\n\n# **1.2 Our task**\n\nIn this exercise, Exploratory Data Analysis (EDA) methods and ggplot functions are used to explore:\n\n-   the variations of Age, sex, population between different planning areas and subzones\n\n-   the distribution of Singapore overall population in terms of Age, sex, etc.\n\n# 1.3 Let's get started!\n\n## **1.3.1 Loading packages**\n\nWe load the following R packages using the `pacman::p_load()` function:\n\n-   **tidyverse**: Core collection of R packages designed for data science\n\n-   **haven**: To read in data formats such as SAS and SPSS\n\n-   **ggrepel**: to provides geoms for **ggplot2** to repel overlapping text labels\n\n-   **ggthemes**: to use additional themes for **ggplot2**\n\n-   **patchwork**: to prepare composite figure created using **ggplot2**\n\n-   **ggridges**: to plot ridgeline plots\n\n-   **ggdist**: for visualizations of distributions and uncertainty\n\n-   **scales**: provides the internal scaling infrastructure used by **ggplot2**\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\npacman::p_load(tidyverse, haven,\n               ggrepel, ggthemes,\n               ggridges, ggdist,colorspace,ggdist,\n               patchwork, scales, ggplot2)\n```\n:::\n\n\n\n## 1.3.2 Importing Data\n\nImporting dataset\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nrespopagesex2024 <- read_csv(\"respopagesex2024.csv\")\nshow_col_types = FALSE\n\nknitr::kable(head(respopagesex2024))\n```\n\n::: {.cell-output-display}\n\n\n|PA         |SZ                     |Age |Sex     | Pop| Time|\n|:----------|:----------------------|:---|:-------|---:|----:|\n|Ang Mo Kio |Ang Mo Kio Town Centre |0   |Males   |  10| 2024|\n|Ang Mo Kio |Ang Mo Kio Town Centre |0   |Females |  10| 2024|\n|Ang Mo Kio |Ang Mo Kio Town Centre |1   |Males   |  10| 2024|\n|Ang Mo Kio |Ang Mo Kio Town Centre |1   |Females |  10| 2024|\n|Ang Mo Kio |Ang Mo Kio Town Centre |2   |Males   |  10| 2024|\n|Ang Mo Kio |Ang Mo Kio Town Centre |2   |Females |  10| 2024|\n\n\n:::\n:::\n\n\n\n# 1.4 Data Pre-Processing\n\nWe first take a look at the data, and check if there are any duplicate entries using glimpse.\n\n## 1.4.1 Glimpse\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nglimpse(respopagesex2024)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nRows: 60,424\nColumns: 6\n$ PA   <chr> \"Ang Mo Kio\", \"Ang Mo Kio\", \"Ang Mo Kio\", \"Ang Mo Kio\", \"Ang Mo K…\n$ SZ   <chr> \"Ang Mo Kio Town Centre\", \"Ang Mo Kio Town Centre\", \"Ang Mo Kio T…\n$ Age  <chr> \"0\", \"0\", \"1\", \"1\", \"2\", \"2\", \"3\", \"3\", \"4\", \"4\", \"5\", \"5\", \"6\", …\n$ Sex  <chr> \"Males\", \"Females\", \"Males\", \"Females\", \"Males\", \"Females\", \"Male…\n$ Pop  <dbl> 10, 10, 10, 10, 10, 10, 10, 10, 30, 10, 20, 10, 20, 30, 30, 10, 3…\n$ Time <dbl> 2024, 2024, 2024, 2024, 2024, 2024, 2024, 2024, 2024, 2024, 2024,…\n```\n\n\n:::\n:::\n\n\n\n## **1.4.2 Checking data structure**\n\n## 1.4.3 Checking for duplicate values\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nrespopagesex2024[duplicated(respopagesex2024),]\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 0 × 6\n# ℹ 6 variables: PA <chr>, SZ <chr>, Age <chr>, Sex <chr>, Pop <dbl>,\n#   Time <dbl>\n```\n\n\n:::\n:::\n\n\n\n## 1.4.4 **Checking for missing values**\n\n## **1.4.5 Filtering data for selected variables**\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nplanning_areas <- read_csv(\"Planning_areas_of_Singapore_2.csv\")\n\n# Check column names\ncolnames(respopagesex2024)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"PA\"   \"SZ\"   \"Age\"  \"Sex\"  \"Pop\"  \"Time\"\n```\n\n\n:::\n\n```{.r .cell-code}\ncolnames(planning_areas)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n [1] \"Name (English)\" \"Malay\"          \"Chinese\"        \"Pinyin\"        \n [5] \"Tamil\"          \"Region\"         \"Area (km2)\"     \"Population\"    \n [9] \"Density (/km2)\" \"Subzones\"      \n```\n\n\n:::\n\n```{.r .cell-code}\nrespop_with_region <- respopagesex2024 %>%\n  left_join(planning_areas, by = c(\"PA\" = \"Name (English)\"))\n\n# View result\n\nglimpse(respop_with_region)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nRows: 60,424\nColumns: 15\n$ PA               <chr> \"Ang Mo Kio\", \"Ang Mo Kio\", \"Ang Mo Kio\", \"Ang Mo Kio…\n$ SZ               <chr> \"Ang Mo Kio Town Centre\", \"Ang Mo Kio Town Centre\", \"…\n$ Age              <chr> \"0\", \"0\", \"1\", \"1\", \"2\", \"2\", \"3\", \"3\", \"4\", \"4\", \"5\"…\n$ Sex              <chr> \"Males\", \"Females\", \"Males\", \"Females\", \"Males\", \"Fem…\n$ Pop              <dbl> 10, 10, 10, 10, 10, 10, 10, 10, 30, 10, 20, 10, 20, 3…\n$ Time             <dbl> 2024, 2024, 2024, 2024, 2024, 2024, 2024, 2024, 2024,…\n$ Malay            <chr> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N…\n$ Chinese          <chr> \"宏茂桥\", \"宏茂桥\", \"宏茂桥\", \"宏茂桥\", \"宏茂桥\", \"宏茂桥\", \"宏茂桥\", \"宏茂桥…\n$ Pinyin           <chr> \"Hóngmàoqiáo\", \"Hóngmàoqiáo\", \"Hóngmàoqiáo\", \"Hóngmào…\n$ Tamil            <chr> \"ஆங் மோ கியோ\", \"ஆங் மோ கியோ\", \"ஆங் மோ கியோ\", \"ஆங் மோ கியோ\", \"ஆங் மோ கியோ\"…\n$ Region           <chr> \"North-East\", \"North-East\", \"North-East\", \"North-East…\n$ `Area (km2)`     <dbl> 13.94, 13.94, 13.94, 13.94, 13.94, 13.94, 13.94, 13.9…\n$ Population       <chr> \"161,000\", \"161,000\", \"161,000\", \"161,000\", \"161,000\"…\n$ `Density (/km2)` <chr> \"13,400\", \"13,400\", \"13,400\", \"13,400\", \"13,400\", \"13…\n$ Subzones         <chr> \"12\", \"12\", \"12\", \"12\", \"12\", \"12\", \"12\", \"12\", \"12\",…\n```\n\n\n:::\n\n```{.r .cell-code}\nhead(respop_with_region)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 6 × 15\n  PA         SZ        Age   Sex     Pop  Time Malay Chinese Pinyin Tamil Region\n  <chr>      <chr>     <chr> <chr> <dbl> <dbl> <chr> <chr>   <chr>  <chr> <chr> \n1 Ang Mo Kio Ang Mo K… 0     Males    10  2024 <NA>  宏茂桥  Hóngm… ஆங் மோ… North…\n2 Ang Mo Kio Ang Mo K… 0     Fema…    10  2024 <NA>  宏茂桥  Hóngm… ஆங் மோ… North…\n3 Ang Mo Kio Ang Mo K… 1     Males    10  2024 <NA>  宏茂桥  Hóngm… ஆங் மோ… North…\n4 Ang Mo Kio Ang Mo K… 1     Fema…    10  2024 <NA>  宏茂桥  Hóngm… ஆங் மோ… North…\n5 Ang Mo Kio Ang Mo K… 2     Males    10  2024 <NA>  宏茂桥  Hóngm… ஆங் மோ… North…\n6 Ang Mo Kio Ang Mo K… 2     Fema…    10  2024 <NA>  宏茂桥  Hóngm… ஆங் மோ… North…\n# ℹ 4 more variables: `Area (km2)` <dbl>, Population <chr>,\n#   `Density (/km2)` <chr>, Subzones <chr>\n```\n\n\n:::\n\n```{.r .cell-code}\nknitr::kable(head(respop_with_region))\n```\n\n::: {.cell-output-display}\n\n\n|PA         |SZ                     |Age |Sex     | Pop| Time|Malay |Chinese |Pinyin      |Tamil      |Region     | Area (km2)|Population |Density (/km2) |Subzones |\n|:----------|:----------------------|:---|:-------|---:|----:|:-----|:-------|:-----------|:----------|:----------|----------:|:----------|:--------------|:--------|\n|Ang Mo Kio |Ang Mo Kio Town Centre |0   |Males   |  10| 2024|NA    |宏茂桥  |Hóngmàoqiáo |ஆங் மோ கியோ |North-East |      13.94|161,000    |13,400         |12       |\n|Ang Mo Kio |Ang Mo Kio Town Centre |0   |Females |  10| 2024|NA    |宏茂桥  |Hóngmàoqiáo |ஆங் மோ கியோ |North-East |      13.94|161,000    |13,400         |12       |\n|Ang Mo Kio |Ang Mo Kio Town Centre |1   |Males   |  10| 2024|NA    |宏茂桥  |Hóngmàoqiáo |ஆங் மோ கியோ |North-East |      13.94|161,000    |13,400         |12       |\n|Ang Mo Kio |Ang Mo Kio Town Centre |1   |Females |  10| 2024|NA    |宏茂桥  |Hóngmàoqiáo |ஆங் மோ கியோ |North-East |      13.94|161,000    |13,400         |12       |\n|Ang Mo Kio |Ang Mo Kio Town Centre |2   |Males   |  10| 2024|NA    |宏茂桥  |Hóngmàoqiáo |ஆங் மோ கியோ |North-East |      13.94|161,000    |13,400         |12       |\n|Ang Mo Kio |Ang Mo Kio Town Centre |2   |Females |  10| 2024|NA    |宏茂桥  |Hóngmàoqiáo |ஆங் மோ கியோ |North-East |      13.94|161,000    |13,400         |12       |\n\n\n:::\n:::\n\n\n\nDeleting\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nrespop_cleaned <- respop_with_region %>%\n  select(-`Time`, -`Malay`, -`Chinese`, -`Pinyin`, -`Tamil`, -`Area (km2)`, -`Population`, -`Density (/km2)`, -`Subzones`)\n\nknitr::kable(head(respop_cleaned))\n```\n\n::: {.cell-output-display}\n\n\n|PA         |SZ                     |Age |Sex     | Pop|Region     |\n|:----------|:----------------------|:---|:-------|---:|:----------|\n|Ang Mo Kio |Ang Mo Kio Town Centre |0   |Males   |  10|North-East |\n|Ang Mo Kio |Ang Mo Kio Town Centre |0   |Females |  10|North-East |\n|Ang Mo Kio |Ang Mo Kio Town Centre |1   |Males   |  10|North-East |\n|Ang Mo Kio |Ang Mo Kio Town Centre |1   |Females |  10|North-East |\n|Ang Mo Kio |Ang Mo Kio Town Centre |2   |Males   |  10|North-East |\n|Ang Mo Kio |Ang Mo Kio Town Centre |2   |Females |  10|North-East |\n\n\n:::\n\n```{.r .cell-code}\nglimpse(respop_cleaned)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nRows: 60,424\nColumns: 6\n$ PA     <chr> \"Ang Mo Kio\", \"Ang Mo Kio\", \"Ang Mo Kio\", \"Ang Mo Kio\", \"Ang Mo…\n$ SZ     <chr> \"Ang Mo Kio Town Centre\", \"Ang Mo Kio Town Centre\", \"Ang Mo Kio…\n$ Age    <chr> \"0\", \"0\", \"1\", \"1\", \"2\", \"2\", \"3\", \"3\", \"4\", \"4\", \"5\", \"5\", \"6\"…\n$ Sex    <chr> \"Males\", \"Females\", \"Males\", \"Females\", \"Males\", \"Females\", \"Ma…\n$ Pop    <dbl> 10, 10, 10, 10, 10, 10, 10, 10, 30, 10, 20, 10, 20, 30, 30, 10,…\n$ Region <chr> \"North-East\", \"North-East\", \"North-East\", \"North-East\", \"North-…\n```\n\n\n:::\n:::\n\n\n# 1.5 Exploratory Data Analysis (EDA)\n\nRegion-wise Age Distribution Using Multiple Density Plots\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(matrixStats)\n\nrespop_cleaned <- respop_cleaned %>%\n  mutate(\n    Age = as.character(Age),\n    Age = ifelse(Age == \"90_and_Over\", \"90\", Age),\n    Age = as.numeric(Age)\n)\n\n# Calculate mode (age with highest density) per region\nmode_age <- respop_cleaned %>%\n  group_by(Region) %>%\n  group_split() %>%\n  map_df(~ {\n    d <- density(rep(.x$Age, .x$Pop))\n    data.frame(\n      Region = unique(.x$Region),\n      mode_age = d$x[which.max(d$y)]\n    )\n  })\n\n# Plot with vertical mode lines\nggplot(respop_cleaned, aes(x = Age, weight = Pop, fill = Region)) +\n  geom_density(alpha = 0.6, adjust = 1) +\n  geom_vline(data = mode_age, aes(xintercept = mode_age), color = \"black\", linetype = \"dashed\", size = 0.8) + \n  geom_text(\n    data = mode_age,\n    mapping = aes(x = mode_age, y = 0, label = paste0(\"Peak: \", round(mode_age, 1))),\n    inherit.aes = FALSE,\n    angle = 90, vjust = -0.5, hjust = 1.1, size = 3\n  ) +\n  facet_wrap(~ Region, scales = \"free_y\", ncol = 2) +\n  labs(\n    title = \"Age Distribution by Region in Singapore (Weighted by Population)\",\n    subtitle = \"Dashed line indicates age with highest density (mode)\",\n    x = \"Age\",\n    y = \"Density\"\n  ) +\n  theme(legend.position = \"none\") +\n  theme_minimal(base_family = \"nunito\") + theme(legend.position = \"none\",axis.text.x = element_text(angle = 90, vjust = 0.5),plot.title = element_text(hjust = 0.5, size = 30, face = \"bold\", family = \"nunito\")) +\n  scale_fill_manual(values = c(\"West\" = \"#145C47\", \"East\" = \"#2C3C60\", \"North\" = \"#662633\",\"North-East\" = \"#4B2C60\",\"Central\" = \"#665C26\"))\n```\n\n::: {.cell-output-display}\n![](TakeHomeEx01_files/figure-html/unnamed-chunk-7-1.png){width=1344}\n:::\n:::\n\n\n\n\n\nGender Ratio Analysis by Region (Male-to-Female Ratio)\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ngender_summary_long <- respop_cleaned %>%\n  group_by(Region, Sex) %>%\n  summarise(Total_Pop = sum(Pop), .groups = \"drop\")\n\n# Step 2: Calculate total population per region\ngender_summary_long <- gender_summary_long %>%\n  group_by(Region) %>%\n  mutate(\n    Region_Total = sum(Total_Pop),\n    Percent = (Total_Pop / Region_Total) * 100\n  )\n\n# Step 3: Plot side-by-side bars with percentage labels\nggplot(gender_summary_long, aes(x = Region, y = Total_Pop, fill = Sex)) +\n  geom_col(position = \"dodge\") +\n  geom_text(\n    aes(label = paste0(round(Percent, 1), \"%\")),\n    position = position_dodge(width = 0.9),\n    vjust = -0.5,\n    size = 3, family = \"nunito\"\n  ) +\n  labs(\n    title = \"Male and Female Population by Region\",\n    x = \"Region\",\n    y = \"Total Population\"\n  ) +\n  scale_y_continuous(labels = scales::comma) +\n  theme_minimal(base_family = \"nunito\") + theme(legend.position = \"none\",axis.text.x = element_text(angle = 90, vjust = 0.5),plot.title = element_text(hjust = 0.5, size = 15, face = \"bold\", family = \"nunito\")) +\n  scale_fill_manual(values = c(\"Females\" = \"#662633\", \"Males\" = \"#2C3C60\"))\n```\n\n::: {.cell-output-display}\n![](TakeHomeEx01_files/figure-html/unnamed-chunk-8-1.png){width=1536}\n:::\n:::\n\n\n\nTotal population by Region\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(\"treemapify\")\nlibrary(showtext)\nfont_add_google(name = \"Nunito Sans\", family = \"nunito\")\nshowtext_auto()\n\n# Summarize total population by region\nregion_summary <- respop_cleaned %>%\n  group_by(Region) %>%\n  summarise(Total_Pop = sum(Pop), .groups = \"drop\")\n\n# Treemap\nggplot(region_summary, aes(area = Total_Pop, fill = Region, label = paste(Region, \"\\n\", scales::comma(Total_Pop)))) +\n  geom_treemap() +\n  geom_treemap_text(colour = \"white\",family = \"nunito\",\n    place = \"centre\",\n    grow = TRUE,\n    size = 14,    \n    fontface = \"bold\") +\n  labs(title = \"Total Population by Region\") +\n  theme_minimal(base_family = \"nunito\") + theme(legend.position = \"none\",axis.text.x = element_text(angle = 90, vjust = 0.5),plot.title = element_text(hjust = 0.5, size = 30, face = \"bold\", family = \"nunito\")) +\n  scale_fill_manual(values = c(\"West\" = \"#145C47\", \"East\" = \"#2C3C60\", \"North\" = \"#662633\",\"North-East\" = \"#4B2C60\",\"Central\" = \"#665C26\"))\n```\n\n::: {.cell-output-display}\n![](TakeHomeEx01_files/figure-html/unnamed-chunk-9-1.png){width=672}\n:::\n:::\n\n\n\nPopulation by Planning Areas\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Summarize total population by planning area for each region\nplanning_area_summary <- respop_cleaned %>%\n  group_by(Region, PA) %>%\n  summarise(Total_Pop = sum(Pop), .groups = \"drop\")\n\n# Bar chart\nggplot(planning_area_summary, aes(x = reorder(PA, -Total_Pop), y = Total_Pop, fill = Region)) +\n  geom_col() +\n  facet_wrap(~ Region, scales = \"free_x\") +\n  labs(title = \"Total Population by Planning Area (within Each Region)\", x = \"Planning Area\", y = \"Population\") +\n  scale_y_continuous(labels = scales::comma) +\n  theme_minimal(base_family = \"nunito\",base_size = 25) +\n  theme(axis.text.x = element_text(angle = 90, vjust = 0.5),plot.title = element_text(hjust = 0.5, size = 30, face = \"bold\", family = \"nunito\")) +\n  scale_fill_manual(values = c(\"West\" = \"#145C47\", \"East\" = \"#2C3C60\", \"North\" = \"#662633\",\"North-East\" = \"#4B2C60\",\"Central\" = \"#665C26\"))\n```\n\n::: {.cell-output-display}\n![](TakeHomeEx01_files/figure-html/unnamed-chunk-10-1.png){width=1536}\n:::\n:::\n\n\n\n# 1.? References\n\n\n",
    "supporting": [
      "TakeHomeEx01_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}